<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Crash Gambling Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            background-color: #f5f5f5;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        #balance, #bet-amount {
            font-size: 18px;
        }

        #result, #live-result {
            font-size: 24px;
            margin-top: 20px;
        }

        #game-history {
            list-style-type: none;
            padding: 0;
            margin-top: 10px;
        }

        #game-history li {
            margin-bottom: 5px;
        }

        #chart {
            width: 100%;
            max-width: 400px;
            height: 200px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }

        button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div id="game-container">
    <h1>Enhanced Crash Gambling Game</h1>
    <p>Starting Balance: $<span id="balance">1000</span></p>
    <p>Bet Amount: $<span id="bet-amount">0</span></p>
    <button onclick="startGame()" id="start-button">Start</button>
    <button onclick="cashOut()" id="cash-out-button" disabled>Cash Out</button>
    <p id="result"></p>
    <p id="live-result"></p>
    <p>Game History:</p>
    <ul id="game-history"></ul>
    <canvas id="chart"></canvas>
</div>

<script>
    let gameStarted = false;
    let crashPoint;
    let chartData = [];
    let playerBalance = 1000;
    let betAmount = 0;
    let gameHistory = [];

    const startButton = document.getElementById("start-button");
    const cashOutButton = document.getElementById("cash-out-button");
    const resultDisplay = document.getElementById("result");
    const liveResultDisplay = document.getElementById("live-result");
    const balanceDisplay = document.getElementById("balance");
    const betAmountDisplay = document.getElementById("bet-amount");
    const gameHistoryList = document.getElementById("game-history");

    function startGame() {
        if (!gameStarted) {
            // Reset for a new round
            gameStarted = true;
            crashPoint = getRandomCrashPoint();
            resultDisplay.innerText = "Game started! Good luck!";
            startButton.disabled = true;
            cashOutButton.disabled = false;
            betAmount = prompt(`Your balance is $${playerBalance}. Enter your bet amount:`);
            if (isNaN(betAmount) || betAmount <= 0 || betAmount > playerBalance) {
                alert("Invalid bet amount. Please enter a valid amount.");
                resetGame();
                return;
            }
            betAmount = parseFloat(betAmount);
            balanceDisplay.innerText = (playerBalance - betAmount).toFixed(2);
            betAmountDisplay.innerText = betAmount.toFixed(2);
            simulateCrash();
        } else {
            alert("Game already started. Please wait for the result.");
        }
    }

    function cashOut() {
        if (gameStarted) {
            const currentResult = getCurrentResult();
            const winnings = (betAmount * crashPoint).toFixed(2);
            const message = currentResult > crashPoint ? `You won $${winnings}!` : "You lost!";
            resultDisplay.innerText = `${message} (Multiplier: ${crashPoint})`;
            gameHistory.unshift({ result: currentResult, winnings: parseFloat(winnings), status: message });
            updateGameHistory();
            playerBalance += currentResult > crashPoint ? parseFloat(winnings) : -betAmount;
            balanceDisplay.innerText = playerBalance.toFixed(2);
            gameStarted = false;
            updateChart();
            startButton.disabled = false;
            cashOutButton.disabled = true;
        } else {
            alert("Game not started. Click 'Start' to begin.");
        }
    }

    function getRandomCrashPoint() {
        return (Math.random() * 10 + 1).toFixed(2); // Increased range to 1 - 11
    }

    function getCurrentResult() {
        const currentResult = parseFloat((Math.random() * 2 + 1).toFixed(2));
        liveResultDisplay.innerText = `Live Result: ${currentResult}`;
        return currentResult;
    }

    function simulateCrash() {
        const interval = setInterval(() => {
            if (gameStarted) {
                const currentResult = getCurrentResult();
                chartData.push(currentResult);
                updateChart();

                if (currentResult >= crashPoint) {
                    resultDisplay.innerText = `Game crashed at ${currentResult}. You lost!`;
                    gameHistory.unshift({ result: currentResult, status: "You lost" });
                    updateGameHistory();
                    gameStarted = false;
                    startButton.disabled = false;
                    cashOutButton.disabled = true;
                    clearInterval(interval);
                }
            }
        }, 1000); // Increased the interval to 1 second
    }

    function updateChart() {
        const canvas = document.getElementById("chart");
        const ctx = canvas.getContext("2d");
        const height = canvas.height;
        const width = canvas.width;

        ctx.clearRect(0, 0, width, height);
        ctx.strokeStyle = "#3498db";
        ctx.lineWidth = 2;

        ctx.beginPath();
        ctx.moveTo(0, height);
        chartData.forEach((value, index) => {
            const x = (index / chartData.length) * width;
            const y = height - value * (height / 11); // Adjusted scaling for the new range
            ctx.lineTo(x, y);
        });
        ctx.stroke();
    }

    function updateGameHistory() {
        gameHistoryList.innerHTML = "";
        gameHistory.forEach((entry, index) => {
            const li = document.createElement("li");
            li.textContent = `Round ${index + 1}: Result ${entry.result}, ${entry.status}`;
            gameHistoryList.appendChild(li);
        });
    }

    function resetGame() {
        gameStarted = false;
        crashPoint = 0;
        chartData = [];
        betAmount = 0;
        playerBalance = 1000;
        balanceDisplay.innerText = playerBalance.toFixed(2);
        betAmountDisplay.innerText = "0.00";
        resultDisplay.innerText = "";
        liveResultDisplay.innerText = "";
        gameHistory = [];
        updateGameHistory();
        updateChart();
        startButton.disabled = false;
        cashOutButton.disabled = true;
    }
</script>
</body>
</html>
